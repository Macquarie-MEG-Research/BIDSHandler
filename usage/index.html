<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Usage - BIDSHandler</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">BIDSHandler</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Home</a>
                            </li>
                            <li class="active">
                                <a href="./">Usage</a>
                            </li>
                            <li >
                                <a href="../api_docs/">API Docs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../api_docs/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#usage">Usage</a></li>
            <li><a href="#loading-data">Loading data</a></li>
            <li><a href="#looking-at-individual-sub-components">Looking at individual sub-components</a></li>
            <li><a href="#addingmerging-bids-data">Adding/merging BIDS data</a></li>
            <li><a href="#querying-bids-data">Querying BIDS data</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="usage">Usage</h2>
<h3 id="loading-data">Loading data</h3>
<p>Loading a BIDS folder is very simple.</p>
<p>Imagine we have a BIDS folder with the following structure:</p>
<pre><code>BIDSFOLDER
└ PROJ01
  └ sub-01
    └ ses-01
      └ meg
        └ &lt;raw files and metadata such as sidecar, channels.tsv etc.&gt;
      └ sub-01_ses-01_scans.tsv
    └ ses-02
      └ meg
        └ &lt;raw files and metadata such as sidecar, channels.tsv etc.&gt;
      └ sub-01_ses-02_scans.tsv
  └ sub-02
    └ ses-01
      └ meg
        └ &lt;raw files and metadata such as sidecar, channels.tsv etc.&gt;
      └ sub-02_ses-01_scans.tsv
  └ dataset_description.json
  └ participants.tsv
  └ README.txt
</code></pre>

<p>We can load this by passing the folder path location to the <code>BIDSTree</code> object:</p>
<pre><code class="python">from BIDSHandler import BIDSTree

folder = BIDSTree('BIDSFOLDER')
</code></pre>

<p>This will load the folder, then recurse over the sub-folders and find all projects, subjects, sessions and (MEG) scans.</p>
<h3 id="looking-at-individual-sub-components">Looking at individual sub-components</h3>
<p>Each of the <code>BIDSTree</code>, <code>Project</code>, <code>Subject</code> and <code>Session</code> objects can be iterated over, to yield the child objects:</p>
<pre><code class="python">for project in folder.projects:
  print(project)
# results:
# ID: PROJ01
# Number of subjects: 2
</code></pre>

<p>We can also pick out individual projects, subjects, session or scans:</p>
<pre><code class="python">sub2 = folder.project('PROJ01').subject('02')
print(sub2)
# results (with made up values):
# ID: sub-02
# Age: 22
# Gender: M
# Group: Control
# Number of Sessions: 1

print(sub2.age)
# 22

ses1 = sub2.session('01')
print(ses1.scans_tsv)
# &lt;base file path&gt;/BIDSFOLDER/PROJ01/sub-02/ses-01/sub-02_ses-01_scans.tsv
</code></pre>

<h3 id="addingmerging-bids-data">Adding/merging BIDS data</h3>
<p>As well as loading in BIDS folders to read the data from them, we can also manipulate the BIDS folders.
This is particularly useful if BIDS data has to be merged if it is converted in multiple locations but all needs to be stored in the one location.
BIDSHandler is capable of merging BIDS data on any level into any other compatible level.
So a single session can be merged in, or entire projects can be merged.
If a single session is merged into a BIDS folder without the project or subject existing already it will be automatically generated so that the BIDS hierarchy is always complete and correct.</p>
<p>Adding in BIDS data is also as simple as a single command.
Consider a second BIDS file structure like:</p>
<pre><code>BIDSFOLDER2
└ PROJ02
  └ sub-03
    └ ses-01
      └ meg
        └ &lt;raw files and metadata such as sidecar, channels.tsv etc.&gt;
      └ sub-03_ses-01_scans.tsv
  └ dataset_description.json
  └ participants.tsv
  └ README.txt
</code></pre>

<p>We can load the folder as before:</p>
<pre><code class="python">folder2 = BIDSTree('BIDSFOLDER2')
</code></pre>

<p>The data in this structure can be added to the previous <code>BIDSTree</code> in a number of different ways:</p>
<pre><code class="python">proj2 = folder2.project('PROJ02')
sub3 = proj2.subject('03')
ses1 = sub3.session('01')

print(folder)
# BIDS folder containing 1 projects

# add the data to the other bids folder (pick one):
folder.add(folder2)
# OR
folder.add(proj2)
# OR
folder.add(sub3)
# OR
folder.add(ses1)

print(folder)
# BIDS folder containing 2 projects
</code></pre>

<p>This will automatically copy all the files over to the new location.
It is also possible to specify a custom copying function (default is minimally wrapped <code>shutils.copy</code> (enhanced to automatically create directories if they do not exist)).</p>
<pre><code class="python">folder.add(folder2, copier=some_other_copy_function)
</code></pre>

<p>For more information and constraints on <code>copier</code> see the docstring for the <code>add</code> function.</p>
<h3 id="querying-bids-data">Querying BIDS data</h3>
<p>One very useful function to be able to perform on any large dataset is to be able to pull out or find the data corresponding to a set of conditions you may have.
<code>BIDSHandler</code> allows you to query data in a simple manner and extract a list of objects that you require.
To understand how this works we can look at the function used:</p>
<pre><code class="python">BIDSTree.query(obj, token, condition, value)
</code></pre>

<p>You can see more information by reading the docstring (<code>help(BIDSTree.query)</code>), however we can summarise the process and meanings here.
 - <code>obj</code> is the name of the object type you want and can be one of <code>'project'</code>, <code>'subject'</code>, <code>'session'</code> or <code>'scan'</code>. The object name must be the of the same level as the object you are querying or lower.
 - <code>token</code> is the name of the data you want to compare. This can be a value like <code>'task'</code>, <code>'group'</code>, or <code>'sessions'</code> for example, or you can use any value that is used as a key in the sidecar.json file.
 To see the full list you can see the docstring by entering
 <code>python
 from BIDSHandler import BIDSTree
 help(BIDSTree.query)</code>
 - <code>condition</code> is one of <code>('&lt;', '&lt;=', '=', '!=', '!!=', '=&gt;', '&gt;')</code> where <code>'!!='</code> here means <code>none equal</code>. This is distinctly different from <code>'!='</code> in that if you ask for the list of subjects that do not contain <code>'task'=='resting'</code> using <code>'!='</code> you will get the list of all subjects that contains tasks that aren't <code>'task'=='resting'</code>. <code>'!!='</code> will however return the list of subjects that have no instances of <code>'task'=='resting'</code>.
 The <code>condition</code> must also be valid for the data type. So for example using a <code>condition</code> of <code>&lt;</code> for a value that is a string will not return any meaningful result or may raise an error.
 - <code>value</code> is the value to check against.
 This value can either be the actual value in the file name, so for <code>token</code> = <code>'task'</code>, the value will be the string in <code>task-value</code>.
 For <code>token</code>'s such as <code>age</code> it will be the age found in the participant.tsv.</p>
<p>Because of the structure of the arguments, it is quite simple to construct queries, as well as read what it is expected that they ask.</p>
<p>All BIDS objects except the <code>Scans</code> object can be queried (ie. <code>BIDSTree</code>, <code>Project</code>, <code>Subject</code>, and <code>Session</code>), and only queries which make sense can be made on these objects. For example the question <em>"what are all the projects in this session that have one subject"</em> obviously makes no sense and will raise an error.</p>
<p>Queries can also be componded to allow for multiple queries to be chained.
This is possible because the object that the <code>query</code> function returns is actually a <code>QueryList</code> object which has all the functionality of a normal python list, however it also has a <code>query</code> method which can be called to apply a query to every member of the list.</p>
<h4 id="examples">Examples:</h4>
<p><em>Task:</em> Find a list of all subjects that are Female.</p>
<pre><code class="python">folder2.query('subject', 'sex', '=', 'F')
</code></pre>

<p>If we let subjects 1 and 3 be female, then this would return the list of those two Subject objects.</p>
<p><em>Task:</em> Find all the projects containing recordings after the 1st of January 2018:</p>
<pre><code class="python">folder2.query('project', 'rec_date_', '&gt;=', '2018-01-01')
</code></pre>

<p>When querying recording dates the date value <em>must</em> be in the format <code>YYYY-MM-DD</code> when specifying a particular date.</p>
<p>The date can also be specified to the second if need be by using a date value of the format <code>"%Y-%m-%dT%H:%M:%S"</code> (the previous date format is <code>"%Y-%m-%d"</code>).</p>
<p><em>Task:</em> Find all the subjects that do not have any resting state tasks:</p>
<pre><code class="python">folder2.query('subject', 'task', '!!=', 'restingstate')
</code></pre>

<p>Where a key-value pair in the BIDS filename of <code>task-restingstate</code> corresponds to resting state data.</p>
<p><em>Task:</em> Find all the subjects that are female and that have 1 session:
First we will find all the subjects that are female, then we will find all the subjects in this list that have only one session.</p>
<pre><code class="python">subjects = folder2.query('subject', 'sex', '=', 'F')
subjects.query('subject', 'sessions', '=', 1)
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
